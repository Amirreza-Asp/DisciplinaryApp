@using DisciplinarySystem.Application.Helpers
@model DisciplinarySystem.Presentation.Controllers.Meetings.ViewModels.GetAllMeetings
@inject DisciplinarySystem.Application.Meetings.Interfaces.IProceedingsService _ipcService


<div class="d-flex justify-content-end mb-3">
	<a asp-action="Index" asp-route-meetingsDate="@Model.MeetingFilter.MeetingsDate" class="btn btn-secondary d-flex align-items-center">
		بازگشت
		<i class="fa fa-angle-left me-2"></i>
	</a>
</div>

<div class="d-flex align-items-start align-items-sm-center justify-content-between mb-2 flex-column flex-sm-row">
	<h3>جلسات روز @Model.MeetingFilter.MeetingsDate.PersianDayOfWeek() @Model.MeetingFilter.MeetingsDate.ToShamsi()</h3>

	<div class="d-flex align-items-center">

		<a asp-action="Create" asp-route-meetingDate="@Model.MeetingFilter.MeetingsDate" class="btn btn--add d-flex align-items-center">
			<i class="fa fa-plus ms-2"></i>افزودن
			جلسه جدید
		</a>
	</div>
</div>

<div class="table-overflow card shadow-sm">
	<div class="table ">
		<table class="table text-center" width="100%">
			<thead>
				<tr>
					<th class="table__row">ردیف</th>
					<th>عنوان</th>
					<th>تاریخ ایجاد</th>
					<th>تاریخ شروع</th>
					<th>زمان شروع</th>
					<th>زمان اتمام</th>
					<th>عملیات</th>
					<th>صورت جلسه</th>
				</tr>
			</thead>
			<tbody>
				@for (int i = 0; i < Model.Meetings.Count(); i++)
				{
					<tr>
						<td>@(i + 1)</td>
						<td>@Model.Meetings.ElementAt(i).Title</td>
						<td>@Model.Meetings.ElementAt(i).CreateDate.ToShamsi()</td>
						<td>
							@Model.Meetings.ElementAt(i).HoldingTime.From.ToShamsi()
						</td>
						<td>
							@Model.Meetings.ElementAt(i).HoldingTime.From.TimeOfDay.ToString().Substring(0,5)
						</td>
						<td>
							@Model.Meetings.ElementAt(i).HoldingTime.To.TimeOfDay.ToString().Substring(0,5)
						</td>
						<td>
							<div class="table__action">
								<a class="btn btn--show" asp-action="Details" asp-route-id="@Model.Meetings.ElementAt(i).Id"><i class="fa fa-eye"></i></a>

								@if (Model.Meetings.ElementAt(i).HoldingTime.From > DateTime.Now)
								{
									<a class="btn btn--edit" asp-action="Update" asp-route-id="@Model.Meetings.ElementAt(i).Id"><i class="fa fa-edit"></i></a>
									<button type="button" class="btn btn--delete me-2" onclick="Delete('/Meeting/Remove/@Model.Meetings.ElementAt(i).Id' , 'جلسه')"><i class="fa fa-trash"></i></button>
								}
							</div>
						</td>
						<td>
							@if (Model.Meetings.ElementAt(i).HoldingTime.From > DateTime.Now)
							{
								<span class="text-danger">شروع نشده</span>
							}
							else if (Model.Meetings.ElementAt(i).HoldingTime.To < DateTime.Now.AddHours(Model.Meetings.ElementAt(i).HoldingTime.From.Hour)
									.AddMinutes(Model.Meetings.ElementAt(i).HoldingTime.From.Minute) &&
									Model.Meetings.ElementAt(i).HoldingTime.To > DateTime.Now)
							{
							<span class="text-info">در حال برگذاری</span>
							}
							else if(await _ipcService.GetByMeetingIdAsync(Model.Meetings.ElementAt(i).Id) == null){
							<a class="btn btn--add" asp-controller="Proceedings" asp-action="Create" asp-route-meetingId="@Model.Meetings.ElementAt(i).Id"><i class="fa fa-plus"></i></a>
							}
							else{
							<div class="table__action">
									<a class="btn btn--show" asp-controller="Proceedings" asp-action="Details" asp-route-meetingId="@Model.Meetings.ElementAt(i).Id"><i class="fa fa-eye"></i></a>
									<a class="btn btn--edit" asp-controller="Proceedings" asp-action="Update" asp-route-meetingId="@Model.Meetings.ElementAt(i).Id"><i class="fa fa-edit"></i></a>
								<button type="button" class="btn btn--delete me-2" onclick="Delete('/Proceedings/Remove/@Model.Meetings.ElementAt(i).Id' , 'صورت جلسه')"><i class="fa fa-trash"></i></button>
							</div>
							}
						</td>
					</tr>
				}
			</tbody>
		</table>
	</div>
</div>


@section Scripts{
	<script src="~/js/utility/removeAlert.js"></script>
}