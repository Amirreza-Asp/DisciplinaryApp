@using DisciplinarySystem.Application.Helpers;
@using DisciplinarySystem.Presentation.Models;
@model DisciplinarySystem.Presentation.Controllers.Complaints.ViewModels.GetComplaintsListVM;


@if (Model.Filters.CaseId > 0)
{
	var step = new CaseSteps
				{
					ActiveStep = "Complaint",
					CaseId = Model.Filters.CaseId,
					OnlySee = Model.Filters.OnlySee
				};

	<partial name="_CaseStepsPartial" model="step" />


	<div class="d-flex justify-content-end mb-3">
		<button type="button" onclick="history.back()" class="btn btn-secondary d-flex align-items-center">
			بازگشت
			<i class="fa fa-angle-left me-2"></i>
		</button>
	</div>
}


<form method="get">
	<input name="caseId" value="@Model.Filters.CaseId" hidden />

	<div class="d-flex align-items-start align-items-sm-center justify-content-between mb-2 flex-column flex-sm-row">
		<h3>شکایات</h3>
		@if (Model.Filters.CaseId <= 0)
		{
			<div class="d-flex align-items-center">

				<a asp-action="Create" asp-route-caseId="@Model.Filters.CaseId" class="btn btn--add d-flex align-items-center">
					<i class="fa fa-plus ms-2"></i>افزودن
					شکایت جدید
				</a>
				<button type="button" onclick="ShowFilters('complaint-filters')" class="btn btn--filter d-flex align-items-center  me-2">
					<i class="fa fa-filter ms-2"></i>فیلتر
				</button>
			</div>
		}
	</div>
	<partial name="_FilterPartial" model="Model.Filters" />

	<div class="table-overflow card card-shadow">
		<div class="table ">
			<table class="table text-center" width="100%">
				<thead>
					<tr>
						<th>ردیف</th>
						<th>موضوع</th>
						<th>شاکی</th>
						<th>متشاکی</th>
						<th>تاریخ ایجاد</th>
						<th>نتیجه</th>
						<th>عملیات</th>
					</tr>
				</thead>
				<tbody>
					@for (int i = 0; i < Model.Complaints.Count(); i++)
					{
						<tr>
							<td>@(i + 1 + Model.Filters.Skip)</td>
							<td>@Model.Complaints.ElementAt(i).Subject</td>
							<td>@Model.Complaints.ElementAt(i).PlaintiffName</td>
							<td>@Model.Complaints.ElementAt(i).ComplainingName</td>
							<td dir="ltr">@Model.Complaints.ElementAt(i).CreateTime.ToShamsi()</td>
							<td>
								@if (@Model.Complaints.ElementAt(i).Result.Equals("تشکیل پرونده"))
								{
									<a asp-controller="Case" asp-action="Create" asp-route-complaintId="@Model.Complaints.ElementAt(i).Id">@Model.Complaints.ElementAt(i).Result</a>
								}
								else if (@Model.Complaints.ElementAt(i).Result.Equals("مشاهده پرونده"))
								{
									<a asp-controller="Case" asp-route-onlySee="@true" asp-action="DetailsByComplaintId" asp-route-complaintId="@Model.Complaints.ElementAt(i).Id">@Model.Complaints.ElementAt(i).Result</a>
								}
								else
								{
									@Model.Complaints.ElementAt(i).Result
								}
							</td>
							<td>
								<div class="table__action">
									<a class="btn btn--show" asp-action="Details" asp-route-id="@Model.Complaints.ElementAt(i).Id" asp-route-caseId="@Model.Filters.CaseId"><i class="fa fa-eye"></i></a>
									@if (!Model.Filters.OnlySee)
									{
										<a class="btn btn--edit" asp-action="Update" asp-route-id="@Model.Complaints.ElementAt(i).Id" asp-route-caseId="@Model.Filters.CaseId"><i class="fa fa-edit"></i></a>
										<button type="button" class="btn btn--delete me-2" onclick="Delete('/Complaint/Remove/@Model.Complaints.ElementAt(i).Id' , 'شکایت')"><i class="fa fa-trash"></i></button>
									}
								</div>
							</td>
						</tr>
					}
				</tbody>
			</table>
		</div>
	</div>
	@if (Model.Filters.CaseId <= 0)
	{
		<partial name="_PagenationPartial" model="@Pagenation.Create(Model.Filters.Skip , Model.Filters.Take , Model.TotalCount)" />
	}
</form>

@section Scripts{
	<script src="~/js/utility/removeAlert.js"></script>
	<script src="~/js/utility/pagenation.js"></script>

}

