@using DisciplinarySystem.Application.Helpers;
@using DisciplinarySystem.Presentation.Models
@model DisciplinarySystem.Presentation.Controllers.Epistles.ViewModels.GetEpistlesListVM

@section Styles{
	<link href="~/css/persianDateTime/kendo.common.min.css" rel="stylesheet" />
	<link href="~/css/persianDateTime/kendo.default.min.css" rel="stylesheet" />
	<link href="~/css/persianDateTime/custom.input.css" rel="stylesheet" />
}

@if (Model.Filters.CaseId > 0)
{
	var step = new CaseSteps
				{
					ActiveStep = "Epistle",
					CaseId = Model.Filters.CaseId,
					OnlySee = Model.Filters.OnlySee
				};

	<partial name="_CaseStepsPartial" model="step" />
}


<form method="get">
	<div class="d-flex align-items-start align-items-sm-center justify-content-between mb-2 flex-column flex-sm-row">
		<h3>نامه ها</h3>
		<div class="d-flex align-items-center">
			@if (!Model.Filters.OnlySee)
			{
				<a asp-action="Create" asp-route-caseId="@Model.Filters.CaseId" class="btn btn--add d-flex align-items-center"><i class="fa fa-plus ms-2"></i>افزودن نامه جدید</a>
			}
			<button type="button" onclick="ShowFilters('epistle-filters')" class="btn btn--filter d-flex align-items-center  me-2"><i class="fa fa-filter ms-2"></i>فیلتر</button>
		</div>

	</div>


	<partial name="_FilterPartial" model="Model.Filters" />
	<section class="card">
		<div class="table-overflow">
			<div class="table ">
				<table class="table text-center" width="100%">
					<thead>
						<tr>
							<th>ردیف</th>
							<th>شماره نامه</th>
							<th>تاریخ ایجاد</th>
							<th>تاریخ ویرایش</th>
							<th>نوع نامه</th>
							<th>موضوع</th>
							<th>فرستنده</th>
							<th>گیرنده</th>
							<th>شکایات مرتبط</th>
							<th>پرونده مرتبط</th>
							<th>عملیات</th>
						</tr>
					</thead>
					<tbody>
						@for (int i = 0; i < Model.Epistles.Count(); i++)
						{
							<tr>
								<td>@(i + 1 + Model.Filters.Skip)</td>
								<td>@Model.Epistles.ElementAt(i).Id</td>
								<td>@Model.Epistles.ElementAt(i).CreateDate.ToShamsi()</td>
								<td>
									@if (Model.Epistles.ElementAt(i).UpdateDate.HasValue)
									{
										<span>@Model.Epistles.ElementAt(i).UpdateDate.Value.ToShamsi()</span>
									}
									else
									{
										<span>_</span>
									}
								</td>
								<td>@Model.Epistles.ElementAt(i).Type</td>
								<td>@Model.Epistles.ElementAt(i).Subject</td>
								<td>@Model.Epistles.ElementAt(i).Sender</td>
								<td>@Model.Epistles.ElementAt(i).Reciver</td>
								<td>
									@if (Model.Epistles.ElementAt(i).ComplaintId.HasValue)
									{
										<a asp-action="Details" asp-controller="Complaint" asp-route-id="@Model.Epistles.ElementAt(i).ComplaintId.Value">مشاهده شکایت</a>
									}
									else
									{
										<span>_</span>
									}
								</td>
								<td>
									@if (Model.Epistles.ElementAt(i).CaseId.HasValue)
									{
										<a asp-action="Details" asp-controller="Case" asp-route-onlySee="@true" asp-route-id="@Model.Epistles.ElementAt(i).CaseId.Value">مشاهده پرونده</a>
									}
									else
									{
										<span>_</span>
									}
								</td>
								<td>
									<div class="table__action">
										<a class="btn btn--show" asp-action="Details" asp-route-id="@Model.Epistles.ElementAt(i).Id" asp-route-withSteps="@(Model.Filters.CaseId>0)"><i class="fa fa-eye"></i></a>
										@if (!Model.Filters.OnlySee)
										{
											<a class="btn btn--edit" asp-action="Update" asp-route-id="@Model.Epistles.ElementAt(i).Id" asp-route-withSteps="@(Model.Filters.CaseId>0)"><i class="fa fa-edit"></i></a>
											<button type="button" class="btn btn--delete me-2" onclick="Delete('/Epistle/Remove/@Model.Epistles.ElementAt(i).Id' , 'نامه')"><i class="fa fa-trash"></i></button>
										}
									</div>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
		</div>

	</section>

	<partial name="_PagenationPartial" model="@Pagenation.Create(Model.Filters.Skip , Model.Filters.Take , Model.TotalCount)" />
	<div class="backdrop"></div>
</form>

@section Scripts{
	<script src="~/js/utility/removeAlert.js"></script>
	<script src="~/js/utility/pagenation.js"></script>
	<script src="~/js/persianDateTime/jquery-1.9.1.min.js"></script>
	<script src="~/js/persianDateTime/jquery.min.js"></script>
	<script src="~/js/persianDateTime/JalaliDate.js"></script>
	<script src="~/js/persianDateTime/kendo.web.js"></script>
	<script src="~/js/persianDateTime/fa-IR.js"></script>
	<script>
		$(document).ready(function () {
			$("#datepicker").kendoDatePicker();
		});
	</script>
}